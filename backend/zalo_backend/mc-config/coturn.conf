# =============================================================================
# coturn TURN server configuration (development)
# =============================================================================
#
# PRODUCTION NOTES:
# ─────────────────
# 1. Replace `realm` with your actual domain (e.g., turn.your-domain.com)
# 2. Enable TLS (TURNS on port 5349):
#    - Uncomment cert/pkey lines below
#    - Provide valid SSL certificates
# 3. Consider managed TURN (Metered.ca, Twilio, Cloudflare)
#    for lower latency + multi-region. Set env vars:
#    TURN_PROVIDER=metered  (or twilio, cloudflare)
#    TURN_API_KEY=<key>
# 4. Widen relay port range for production traffic:
#    min-port=49152
#    max-port=65535
# 5. Enable redis-statsdb for multi-instance TURN metrics
# 6. Set `total-quota` and `bps-capacity` based on server specs
# =============================================================================

# Listener
listening-port=3478
tls-listening-port=5349

# Relay port range (narrow for dev, widen for production)
min-port=50000
max-port=50050

# Realm
realm=zalo-clone.local

# Use long-term credential mechanism with shared secret (RFC 5766)
# The NestJS backend generates HMAC-SHA1 credentials using this secret.
#
# NOTE: `static-auth-secret` is intentionally NOT set here.
# coturn does NOT expand shell variables in config files, so the secret
# is injected via --static-auth-secret CLI flag in docker-compose.yml,
# where Docker Compose substitutes ${TURN_SECRET} from the .env file.
use-auth-secret

# PRODUCTION: Uncomment for TLS (TURNS)
# cert=/etc/coturn/certs/turn.pem
# pkey=/etc/coturn/certs/turn.key

# Logging
log-file=stdout
verbose

# Security
fingerprint
no-multicast-peers
no-cli

# Disable TCP relay (UDP-only for media — better performance)
no-tcp-relay

# Stale nonce lifetime (seconds)
stale-nonce=600

# Max allocation lifetime
max-allocate-lifetime=3600
